# Kinematic and Analytic Jacobian

## Derivation of the Jacobian {.smaller}

:::: {.columns}

::: {.column width="80%"}
* Consider an $n$-link manipulator with joint variables $q_1, \ldots, q_n$ and
let ${^0}\bm{T}_n$ denote the transformation from the end-effector frame
$\Sigma_n$ to the base frame $\Sigma_0$.
:::

::: {.column width="20%"}
$$
{^0}\bm{T}_n = \begin{pmatrix}
{^0}\bm{R}_n(\bm{q}) & {^0}\bm{o}_n(\bm{q}) \\ \bm{0} & 1
\end{pmatrix}
$$
:::

::::

* The objective is to relate the linear and angular velocity (the twist) of the
end-effector $\Sigma_n$ to the vector of joint rates or velocities $\dot{\bm{q}}(t)$.


:::: {.columns}

::: {.column width="80%"}

<p style="line-height:10%"><br></p>

* With $\bm{J}_v, \bm{J}_\omega \in \mathbb{R}^{3\times n}$, we seek expressions
of the form

<p style="line-height:0%"><br></p>

* With $\bm{J}$ denoting the __manipulator Jacobian__ or __Jacobian__, together
they can be written as $\bm{\eta} = \bm{J}\dot{\bm{q}}$.
:::

::: {.column width="20%"}
$$
\begin{aligned}
{^0}\bm{v}_n &= \bm{J}_v \dot{\bm{q}} \\
{^0}\bm{\omega}_n &= \bm{J}_\omega \dot{\bm{q}}
\end{aligned}
$$

$$
\bm{\eta} = \begin{pmatrix}
{^0}\bm{v}_n \\ {^0}\bm{\omega}_n
\end{pmatrix} \quad \text{and} \quad
\bm{J} = \begin{pmatrix}
\bm{J}_v \\ \bm{J}_\omega
\end{pmatrix}_{6 \times n}
$$

:::

* This twist $\bm{\eta}$ is __NOT__ the derivative of a pose variable, since the
angular velocity vector is tno the derivative of any particular time-varying
quantity.

::::



## Angular velocity {.smaller}

* We can determine ${^0}\bm{\omega}_{0,n}$ by expressing the angular velocity
contributed by each joint in $\Sigma_0$ and then summing these.
  - If joint $i$ is revolute, then the $i^\text{th}$ variable $q_i = \theta_i$
    and the axis of rotation is $\bm{z}_{i-1}$.
  - Recall: ${^{i-1}}\bm{\omega}_{i-1,i}$ is the angular velocity of link $i$
    that is imparted by the rotation of joint $i$, expressed relative to
    $\Sigma_{i-1}$. With $\bm{k} = \begin{pmatrix} 0 & 0 & 1 \end{pmatrix}^\top$ we
    have $${^{i-1}}\bm{\omega}_{i-1, i} = \dot{q}_i{^{i-1}}\bm{z}_{i-1} =
    \dot{q}_i \bm{k}.$$
  - If the joint $i$ is prismatic, then the motion of $\Sigma_i$ w.r.t.
    $\Sigma_{i-1}$ is a pure translation and $$ {^{i-1}}\bm{\omega}_{i-1,i} =
    \bm{0}. $$
* Therefore, the overall angular velocity of the end-effector
${^0}\bm{\omega}_{0,n}$ is determined by
$$
\begin{aligned}
{^0}\bm{\omega}_{0,n} &= {^0}\bm{\omega}_{0, 1} + {^0}\bm{R}_1{^1}\bm{\omega}_{1,
2} + {^0}\bm{R}_2{^2}\bm{\omega}_{2,3} + \cdots +
{^0}\bm{R}_{n-1}{^{n-1}}\bm{\omega}_{n-1, n} \\ 
&= \rho_1\dot{q}_1\bm{k} + \rho_2\dot{q}_2{^0}\bm{R}_1\bm{k} + \cdots +
\rho_n\dot{q}_n{^0}\bm{R}_{n-1}\bm{k} = \sum_{i=1}^n
\rho_i\dot{q}_i{^0}\bm{z}_{i-1},
\end{aligned}
$$
since ${^0}\bm{z}_{i-1} = {^0}\bm{R}_{i-1}\bm{k}$, where $\rho_i$ is equal to
$1$ if joint $i$ is revolute and $0$ if it is prismatic.
* Hence, we have found $\bm{J}_\omega$ as 

$$ \bm{J}_\omega = \begin{pmatrix} \rho_1\bm{z}_0 & \rho_2\bm{z}_1 & \cdots &
\rho_n \bm{z}_{n-1} \end{pmatrix}. $$ where all $\bm{z}$-axes are expressed in
the world frame $\Sigma_0$.


## Linear velocity {.smaller}

&nbsp;

&nbsp;



:::: {.columns}

::: {.column width="50%"}
* By the chain rule for differentiation 

$${^0}\dot{\bm{o}}_n = \sum_{i=1}^n \frac{\partial {^0}\bm{o}_n}{\partial q_i}\dot{q}_i.$$
:::

::: {.column width="50%"}
* Thus, the $i^{\text{th}}$ column, $\bm{J}_{v_i}$ of $\bm{J}_v$ is given by

$$\bm{J}_{v_i} = \frac{\partial {^0}\bm{o}_n}{\partial q_i}.$$ 
:::

&nbsp;

* Note that the $i^{\text{th}}$ column, $\bm{J}_{v_i}$, of the Jacobian may be
generated by holding all joints but the $i^{\text{th}}$ one fixed and actuating 
the $i^{\text{th}}$ at unit velocity.

::::



## Linear velocity {.smaller}


:::: {.columns}

::: {.column width="75%"}
* If joint $i$ is _prismatic_, it imparts a pure translation to the end-effector.
* The direction of this translation is $\parallel$ to $\bm{z}_{i-1}$ and the
magnitude is $\dot{d}_i$.
* Thus, expressed in $\Sigma_0$, we obtain
$$
{^0}\dot{\bm{o}}_n = \dot{d}_i{^0}\bm{R}_{i-1}\begin{pmatrix} 0 & 0 & 1
\end{pmatrix}^\top = \dot{d}_i{^0}\bm{z}_{i-1},
$$
in which $d_i$ is the joint variable for the prismatic joint $i$.
* After dropping the superscripts, we have 

$$ \bm{J}_{v_i} = \bm{z}_{i-1}. $$
:::

::: {.column width="25%"}
<center>
<img data-src="contents/assets/motion_due_to_prismatic.png" width="100%"/>
</center>
:::

::::

:::: {.columns}

::: {.column width="75%"}
* If joint $i$ _revolute_, we have $q_i = \theta_i$.
* We observe that the linear velocity of the end-effector is sipmly of the form
$\bm{\omega} \times \bm{r}$, where $$ \bm{\omega} = \dot{\theta}_i\bm{z}_{i-1}
\qquad \text{and} \qquad \bm{r} = \bm{o}_n - \bm{o}_{i-1}. $$
* Putting these together and expressing the coordinates relative to $\Sigma_0$, 
for a revolute joint we obtain

$$
\bm{J}_{v_i} = \bm{z}_{i-1} \times (\bm{o}_n - \bm{o}_{i-1}).
$$
:::

::: {.column width="25%"}
<center>
<img data-src="contents/assets/motion_due_to_revolute.png" width="100%"/>
</center>
:::

::::




## <span style="font-size:93%">Combining linear and angular velocity Jacobians </span> {.smaller}

:::: {.columns}

::: {.column width="60%"}
* The upper half, $\bm{J}_v$, of the Jacobian $\bm{J}$ is given as

$$ \bm{J}_v = \begin{pmatrix} \bm{J}_{v_1} & \bm{J}_{v_2} & \cdots &
\bm{J}_{v_n} \end{pmatrix} $$

<p style="line-height:30%"><br></p>

* The lower half, $\bm{J}_\omega$, of the Jacobian $\bm{J}$ is given as 

$$ \bm{J}_\omega = \begin{pmatrix} \bm{J}_{\omega_1} & \bm{J}_{\omega_2} & \cdots &
\bm{J}_{\omega_n} \end{pmatrix} $$
:::

::: {.column width="40%"}
* The $i^{\text{th}}$ column $\bm{J}_{v_i}$ is 
$$
\bm{J}_{v_i} = 
\begin{cases}
    \bm{z}_{i-1} \times (\bm{o}_n - \bm{o}_{i-1}) & \mbox{for revolute joint $i$} \\
    \bm{z}_{i-1} & \mbox{for prismatic joint $i$}
\end{cases}
$$

* The $i^{\text{th}}$ column of $\bm{J}_{\omega_i}$ is
$$
\bm{J}_{\omega_i} = 
\begin{cases}
    \bm{z}_{i-1} & \mbox{for revolute joint $i$} \\
    0 & \mbox{for prismatic joint $i$}
\end{cases}
$$
:::

* The only quantities needed to compute the Jacobian are the unit vectors
$\bm{z}_i$ and the coordinates of the origins $o_1, \ldots, o_n$.

* The coordinates for $\bm{z}_i$ w.r.t. $\Sigma_0$ are given by the first three
elements in the third column of ${^0}\bm{T}_i$.

* ${^0}\bm{o}_i$ is given by the first three elements of the fourth column of
${^0}\bm{T}_i$.

* This procedure works not only for computing the velocity of the end-effector
but also for computing the velocity of any point on the manipulator.

::::


## Example 1: Two-link planar manipulator {.smaller}

:::: {.columns}

::: {.column width="71.5%"}
* Since both joints are revolute, the Jacobian matrix is of the form

$$
J(q) = \begin{pmatrix}
    \bm{z}_0 \times (\bm{o}_2-\bm{o}_0) & \bm{z}_1 \times (\bm{o}_2-\bm{o}_1) \\ 
    \bm{z}_0 & \bm{z}_1
\end{pmatrix}
$$

* The various quantities are: &nbsp; $\bm{z}_0 = \bm{z}_1 = \begin{pmatrix} 0 & 0 & 1
\end{pmatrix}^\top$ and
$$ \bm{o}_0 = \bm{0}, \;\; \bm{o}_1 = \begin{pmatrix} a_1c_1 & a_1s_1 & 0
\end{pmatrix}^\top, \;\; \bm{o}_2 = \begin{pmatrix} a_1c_1 + a_2c_{12} & a_1s_1 + a_2s_{12} & 0 \end{pmatrix}. $$

:::

::: {.column width="28.5%"}
<center>
<img data-src="contents/assets/two_link_planar_manipulator.png" width="100%"/>
</center>

:::

::::

:::: {.columns}

::: {.column width="67%"}
* The first two rows give the linear velocity of the origin $o_2$ relative to
the base.

* The third row is the linear velocity of $o_2$ in the direction of $\bm{z}_0$.

* The last three rows represent the angular velocity of the final frame
$\Sigma_2$, which is basic rotation about the vertical axis at the rate
$\dot{\theta}_1 + \dot{\theta}_2$.
:::

::: {.column width="33%"}
$$
\bm{J} = 
\begin{pmatrix}
-a_1s_1 - a_2s_{12} & -a_2s_{12} \\
a_1c_1 + a_2c_{12} & a_2c_{12} \\
0 & 0 \\
0 & 0 \\
0 & 0 \\
1 & 1
\end{pmatrix}
$$

:::

::::



## <span style="font-size:88%">Example 2: Jacobian for an arbitrary point on a link </span> {.smaller}

&nbsp;

:::: {.columns}

::: {.column width="60%"}
* Suppose we wish to compute the linear velocity $\bm{v}$ of the center of link
$2$ as shown.

$$
\bm{J}(q) = \begin{pmatrix}
    \bm{z}_0 \times (\bm{o}_c-\bm{o}_0) & \bm{z}_1 \times (\bm{o}_c-\bm{o}_1) & 0\\ 
    \bm{z}_0 & \bm{z}_1 & 0
\end{pmatrix}
$$

which is merely the Jacobian of $o_c$ in place of $o_n$.

&nbsp;

* The third column of the Jacobian is zero since the velocity of the second link
is unaffected by the motion of the third link.
:::

::: {.column width="40%"}
<center>
<img data-src="contents/assets/vel_of_planar_robot.png" width="100%"/>
</center>

&nbsp;

::: {.callout-tip icon="false"}
## Velocity of link $2$ of a $3$-link planar robot
In this case the vector ${^0}\bm{o}_c$ must be computed as it is not given
directly by the $\bm{T}$ matrices.
:::

:::

::::






## Example 3: Stanford manipulator {.smaller}

* Joint $3$ is prismatic and $o_3 = o_4 = o_5$ as a consequence of the spherical
wrist and frame assignments.

* Denoting this common origin by $\bm{o}$, we see that the columns of the
Jacobian have the form

$$
\begin{aligned}
    \bm{J}_i &= \begin{pmatrix}
    \bm{z}_{i-1} \times (\bm{o}_6 - \bm{o}_{i-1}) \\ \bm{z}_{i-1}
    \end{pmatrix}, \; \; i = 1,2, \\
    \bm{J}_3 &= \begin{pmatrix}\bm{z}_2 \\ 0 \end{pmatrix}, \\
    \bm{J}_i &= \begin{pmatrix} \bm{z}_{i-1} \times (\bm{o}_6 - \bm{o}) \\ \bm{z}_{i-1}
    \end{pmatrix}, \; \; i = 4,5,6.
\end{aligned}
$$


## Example 4: SCARA manipulator {.smaller}

* This Jacobian is a $6 \times 4$ matrix since SCARA has only four degrees of
freedom.

* We need only compute the matrices ${^0}\bm{T}_j = \bm{A}_1 \cdots \bm{A}_j$.

* Joints $1$, $2$, and $4$ are revolut and joint $3$ is prismatic so 

$$
\bm{J} = \begin{pmatrix}
    \bm{z}_0 \times (\bm{o}_4 - \bm{o}_0) & \bm{z}_1 \times (\bm{o}_4 - \bm{o}_1) & \bm{z}_2 & 0 \\ 
    \bm{z}_0 & \bm{z}_1 & 0 & \bm{z}_3
\end{pmatrix}
= \begin{pmatrix}
    -a_1s_1 - a_2s_{12} & -a_2s_{12} & 0 & 0 \\
    a_1c_1 + a_2c_{12} & a_2c_{12} & 0 & 0 \\
    0 & 0 & -1 & 0 \\
    0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 \\
    1 & 1 & 0 & -1
\end{pmatrix}.
$$

where we used the fact that $\bm{o}_4 -\bm{o}_3 \parallel \bm{z}_3$ and thus
$$ \bm{z}_3 \times (\bm{o}_4 - \bm{o}_3) = \bm{0}. $$
